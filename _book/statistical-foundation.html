<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>4 Statistical Foundation | Learning Data Science with R</title>
<meta name="author" content="Peter Baumgartner">
<meta name="description" content="4.1 Introduction Notes of this chapter references chapter 9 Statistical Foundation of Modern Data Science with R, 2nd edition. This chapter will elucidate some of the connections between the...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="4 Statistical Foundation | Learning Data Science with R">
<meta property="og:type" content="book">
<meta property="og:description" content="4.1 Introduction Notes of this chapter references chapter 9 Statistical Foundation of Modern Data Science with R, 2nd edition. This chapter will elucidate some of the connections between the...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="4 Statistical Foundation | Learning Data Science with R">
<meta name="twitter:description" content="4.1 Introduction Notes of this chapter references chapter 9 Statistical Foundation of Modern Data Science with R, 2nd edition. This chapter will elucidate some of the connections between the...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="css/bs4_style.css">
<link rel="stylesheet" href="css/boxes.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Learning Data Science with R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled"><li><a class="" href="index.html"><span class="header-section-number">4</span> Statistical Foundation</a></li></ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/petzi53/ldsr">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="statistical-foundation" class="section level1" number="4">
<h1>
<span class="header-section-number">4</span> Statistical Foundation<a class="anchor" aria-label="anchor" href="#statistical-foundation"><i class="fas fa-link"></i></a>
</h1>
<div id="introduction-2" class="section level2" number="4.1">
<h2>
<span class="header-section-number">4.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-2"><i class="fas fa-link"></i></a>
</h2>
<p>Notes of this chapter references chapter 9 <a href="https://mdsr-book.github.io/mdsr2e/ch-foundations.html">Statistical Foundation</a> of <a href="https://mdsr-book.github.io/mdsr2e/">Modern Data Science with R</a>, 2nd edition.</p>
<p>This chapter will elucidate some of the connections between the sample — the data we’ve got — and the population. To do this, we’ll use an artifice: constructing a playground that contains the entire population. Then, we can work with data consisting of a smaller set of cases selected at random from this population. This lets us demonstrate and justify the statistical methods in a setting where we know the “correct” answer. That way, we can develop ideas about how much confidence statistical methods can give us about the patterns we see.</p>
<p>The interesting thing to learn here is that we can draw statistical conclusion and to compare them with the “real” dataset. So we will get not only a theoretical explanation of the statistical parameters of the sample but we will also see their relationships with the population data.</p>
<div id="simulated-task" class="section level3" number="4.1.1">
<h3>
<span class="header-section-number">4.1.1</span> Simulated task<a class="anchor" aria-label="anchor" href="#simulated-task"><i class="fas fa-link"></i></a>
</h3>
<p>Suppose you were asked to help develop a travel policy for business travelers based in New York City. Imagine that the traveler has a meeting in San Francisco (airport code SFO) at a specified time<br><span class="math inline">\(t\)</span>. The policy to be formulated will say how much earlier than <span class="math inline">\(t\)</span> an acceptable flight should arrive in order to avoid being late to the meeting due to a flight delay.</p>
<p>For the purpose of this example we are going to pretend that we already have on hand the complete population of flights. For this purpose, we’re going to use the subset of 336,776 flights in 2013 in the <strong>{nycflights13}</strong> package, which gives airline delays from New York City airports in 2013. The policy we develop will be for 2013. Of course this is unrealistic in practice. If we had the complete population we could simply look up the best flight that arrived in time for the meeting!</p>
</div>
<div id="setup-1" class="section level3" number="4.1.2">
<h3>
<span class="header-section-number">4.1.2</span> Setup<a class="anchor" aria-label="anchor" href="#setup-1"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="co">#&gt; ── Attaching packages ────────────────────────────────── tidyverse 1.3.1 ──</span>
<span class="co">#&gt; ✓ ggplot2 3.3.5     ✓ purrr   0.3.4</span>
<span class="co">#&gt; ✓ tibble  3.1.6     ✓ dplyr   1.0.7</span>
<span class="co">#&gt; ✓ tidyr   1.1.4     ✓ stringr 1.4.0</span>
<span class="co">#&gt; ✓ readr   2.1.1     ✓ forcats 0.5.1</span>
<span class="co">#&gt; ── Conflicts ───────────────────────────────────── tidyverse_conflicts() ──</span>
<span class="co">#&gt; x dplyr::filter() masks stats::filter()</span>
<span class="co">#&gt; x dplyr::lag()    masks stats::lag()</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mdsr-book/mdsr">mdsr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/nycflights13">nycflights13</a></span><span class="op">)</span>
<span class="co"># library(conflicted)</span></code></pre></div>
<p>More realistically, the problem would be to develop a policy for this year based on the sample of data that have already been collected. We’re going to simulate this situation by drawing a sample from the population of flights into SFO. Playing the role of the population in our little drama, SF comprises the complete collection of such flights.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SF</span> <span class="op">&lt;-</span> <span class="va">flights</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">dest</span> <span class="op">==</span> <span class="st">"SFO"</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">arr_delay</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We get 13,173 records including already the substracted 158 observations where a value for <code>arr_delay</code> is not available (<code>NA</code>). The filter code combines two logical expressions: It chooses all “SFO” destinations <em>and</em> does <em>not</em> select (<code>!</code>) flights where no values are available (<code>NA</code>’s). We could have used the following code to express the <code>AND</code> operation explicitly: <code>filter(dest == "SFO" &amp; !is.na(arr_delay)</code>. When multiple expressions are used, they are always combined using <code>&amp;</code>. If you want to use the logical operator <code>OR</code> you have always to write it <code>|</code> to combine the two expressions.</p>
</div>
</div>
<div id="population-sample" class="section level2" number="4.2">
<h2>
<span class="header-section-number">4.2</span> Population sample<a class="anchor" aria-label="anchor" href="#population-sample"><i class="fas fa-link"></i></a>
</h2>
<div id="sample-size-n-25" class="section level3" number="4.2.1">
<h3>
<span class="header-section-number">4.2.1</span> Sample size <span class="math inline">\(n = 25\)</span><a class="anchor" aria-label="anchor" href="#sample-size-n-25"><i class="fas fa-link"></i></a>
</h3>
<p>We’re going to work with just a sample from this population. For now, we’ll set the sample size to be <span class="math inline">\(n = 25\)</span> cases.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">101</span><span class="op">)</span>
<span class="va">sf_25</span> <span class="op">&lt;-</span> <span class="va">SF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></code></pre></div>
<p>The function <code><a href="https://rdrr.io/r/base/Random.html">set.seed()</a></code> is necessary to ensure that the pseudo random generator will get the same results as in the book.</p>
<p>The function <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample()</a></code> is the new and actual variant to sample rows from a table. It is a special application from other methods of subsetting rows (<code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_tail()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_min()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max()</a></code>). It supersedes the <code><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_n()</a></code> function that you will still see often in older books.</p>
<div class="infobox">
<p>To see what the data are like, people often use the <code><a href="https://rdrr.io/r/utils/head.html">head()</a></code> or <code><a href="https://rdrr.io/r/utils/head.html">tail()</a></code> function. But the first and last rows of dataset are sometimes different and therefore note representative of the data. Instead use <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample()</a></code>, for instance <code>slice_sample(n = 10)</code>.</p>
</div>
<p>To repeat and emphasize what we have done so far: We have drawn a <a href="https://en.wikipedia.org/wiki/Sample_(statistics)">sample</a> of 25 rows from out simulated <a href="https://en.wikipedia.org/wiki/Statistical_population">population</a>.</p>
</div>
<div id="a-longest-flight-delay" class="section level3" number="4.2.2">
<h3>
<span class="header-section-number">4.2.2</span> A: Longest flight delay<a class="anchor" aria-label="anchor" href="#a-longest-flight-delay"><i class="fas fa-link"></i></a>
</h3>
<p>A simple (but näive) way to set the policy is to look for the longest flight delay and insist that travel be arranged to deal with this delay.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sf_25</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/mdsr/man/skim.html">skim</a></span><span class="op">(</span><span class="va">arr_delay</span><span class="op">)</span></code></pre></div>
<p><strong>Variable type: numeric</strong></p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">var</th>
<th align="right">n</th>
<th align="right">na</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">arr_delay</td>
<td align="right">25</td>
<td align="right">0</td>
<td align="right">0.12</td>
<td align="right">29.79</td>
<td align="right">-38</td>
<td align="right">-23</td>
<td align="right">-5</td>
<td align="right">14</td>
<td align="right">103</td>
</tr></tbody>
</table></div>
<div class="infobox">
<p>The <code><a href="https://rdrr.io/pkg/mdsr/man/skim.html">skim()</a></code> function is imported to the book <strong>{mdsr}</strong> package. It stems originally from the <strong>{skimr}</strong> package, which has many other useful functions for exploratory data analysis (EDA).</p>
</div>
<p>The longest delay in our sample is 103 minutes. So, should our travel policy be that the traveler should plan on arriving in SFO about 2 hours (120 minutes) ahead?</p>
<p>Keep in mind that we have drawn just a sample, and minimum and maximum values are extremely fragile. Particular values depend to a much degree on random events. checking these extrreme values in our “population” shows this demonstratively:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/mdsr/man/skim.html">skim</a></span><span class="op">(</span><span class="va">arr_delay</span><span class="op">)</span></code></pre></div>
<p><strong>Variable type: numeric</strong></p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">var</th>
<th align="right">n</th>
<th align="right">na</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">arr_delay</td>
<td align="right">13173</td>
<td align="right">0</td>
<td align="right">2.67</td>
<td align="right">47.67</td>
<td align="right">-86</td>
<td align="right">-23</td>
<td align="right">-8</td>
<td align="right">12</td>
<td align="right">1007</td>
</tr></tbody>
</table></div>
<p>The actual worst delay in 2013 was 1007 minutes, about 17 hours. This suggests that to avoid missing a meeting, you should travel the day before the meeting. Safe enough, but then:</p>
<ul>
<li>Even at that extreme measure, there’s no guarantee that there will never be a delay of more than 1,007 minutes.</li>
<li>Besides that consideration: An extra travel day is expensive in terms of lodging, meals, and the traveler’s time.</li>
</ul>
</div>
<div id="b-98-chance" class="section level3" number="4.2.3">
<h3>
<span class="header-section-number">4.2.3</span> B: 98% chance<a class="anchor" aria-label="anchor" href="#b-98-chance"><i class="fas fa-link"></i></a>
</h3>
<p>A sensible travel policy will trade off small probabilities of being late against the savings in cost and traveler’s time. For instance, you might judge it acceptable to be late just 2% of the time — a 98% chance of being on time.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sf_25</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>q98 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">arr_delay</span>, p <span class="op">=</span> <span class="fl">0.98</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 × 1</span>
<span class="co">#&gt;     q98</span>
<span class="co">#&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1  67.5</span></code></pre></div>
<p>A delay of 68 minutes is more than an hour. The calculation is easy, but how good is the answer? This is not a question about whether the <span class="math inline">\(98^{th}\)</span> percentile was calculated properly—that will always be the case for any competent data scientist. The question is really along these lines: Suppose we used a 90-minute travel policy. So we would have a safety margin of 22 minutes, or about 33%. How well would that have worked in achieving our intention to be late for meetings only 2% of the time?</p>
<p>With our “population” data in hand, it’s easy to answer this question.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">arr_delay</span> <span class="op">&lt;</span> <span class="fl">90</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>pct <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">SF</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 2 × 3</span>
<span class="co">#&gt; # Groups:   arr_delay &lt; 90 [2]</span>
<span class="co">#&gt;   `arr_delay &lt; 90`     n    pct</span>
<span class="co">#&gt;   &lt;lgl&gt;            &lt;int&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1 FALSE              640 0.0486</span>
<span class="co">#&gt; 2 TRUE             12533 0.951</span></code></pre></div>
<p>The 90-minute policy would miss its mark 5% of the time, much worse than we intended. To correctly hit the mark 2% of the time, we will want to increase the policy from 90 minutes to what value?</p>
<p>With the population, it’s easy to calculate the <span class="math inline">\(98^{th}\)</span> percentile of the arrival delays:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>q98 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">arr_delay</span>, p <span class="op">=</span> <span class="fl">0.98</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 × 1</span>
<span class="co">#&gt;     q98</span>
<span class="co">#&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1   153</span></code></pre></div>
<p>It should have been about 150 minutes.</p>
<p>But in most real-world settings, we do not have access to the population data. We have only our sample.</p>
<p>Another problem is, that calculating the <span class="math inline">\(98^{th}\)</span> percentile is — similar as the minimum and maximum we mentioned before — not a reliable sample statistic for small samples (such as our 25 flights into SFO), in the sense that it will vary considerably in small samples.</p>
<p>Ultimately we need to figure out the reliability of a sample statistic from the sample itself. For now, though, we are going to use the population to develop some ideas about how to define reliability. So we will still be in the playground world where we have the population in hand.</p>
</div>
<div id="c-sampling-distribution" class="section level3" number="4.2.4">
<h3>
<span class="header-section-number">4.2.4</span> C: Sampling distribution<a class="anchor" aria-label="anchor" href="#c-sampling-distribution"><i class="fas fa-link"></i></a>
</h3>
<p>If we were to collect a new sample from the population, how similar would the sample statistic on that new sample be to the same statistic calculated on the original sample? Or, stated somewhat differently, if we draw many different samples from the population, each of size <span class="math inline">\(n\)</span>, and calculated the sample statistic on each of those samples, how similar would the sample statistic be across all the samples?</p>
<p>With the population in hand, it’s easy to figure this out; use <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample()</a></code> many times and calculate the sample statistic on each trial. For instance, here are two trials in which we sample and calculate the mean arrival delay.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">25</span>
<span class="va">SF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean_arr_delay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">arr_delay</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 × 1</span>
<span class="co">#&gt;   mean_arr_delay</span>
<span class="co">#&gt;            &lt;dbl&gt;</span>
<span class="co">#&gt; 1          -5.92</span>

<span class="va">SF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean_arr_delay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">arr_delay</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 × 1</span>
<span class="co">#&gt;   mean_arr_delay</span>
<span class="co">#&gt;            &lt;dbl&gt;</span>
<span class="co">#&gt; 1           9.24</span></code></pre></div>
<p>As the book not used the <code><a href="https://rdrr.io/r/base/Random.html">set.seed()</a></code> function my (and your) result will differ from the book.</p>
<p>Perhaps it would be better to run many trials (though each one would require considerable effort in the real world). The <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code> function from the <strong>{purrr}</strong> package lets us automate the process. Here are the results from 500 trials.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">num_trials</span> <span class="op">&lt;-</span> <span class="fl">500</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">321</span><span class="op">)</span>
<span class="va">sf_25_means</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="va">num_trials</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span>
    <span class="op">~</span> <span class="va">SF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean_arr_delay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">arr_delay</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">sf_25_means</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 × 2</span>
<span class="co">#&gt;   mean_arr_delay     n</span>
<span class="co">#&gt;            &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1           5.68    25</span>
<span class="co">#&gt; 2          13.4     25</span>
<span class="co">#&gt; 3          -6.56    25</span>
<span class="co">#&gt; 4          -0.36    25</span>
<span class="co">#&gt; 5           3       25</span>
<span class="co">#&gt; 6         -12.4     25</span></code></pre></div>
<p>Again we will get different results as the book. The <code><a href="https://rdrr.io/r/base/Random.html">set.seed()</a></code> function has to be invoked immediately before each random operation. It is not like a variable which value is stored and used again when it is called. In contrast to the book I have here used it, so that — if you want — you can reproduce my results.</p>
<p><code><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr()</a></code> requires a function, formula, or vector. Here — with tilde symbol (<code>~</code>) — we are using a formula. <code><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr()</a></code> returns a data frame created by row-binding. <code>df</code> stands for data frame and the <code>r</code> for row-binding. There is another similar function <code><a href="https://purrr.tidyverse.org/reference/map.html">map_dfc()</a></code> where the data frame is created by column-binding.</p>
<p>We now have 500 trials, for each of which we calculated the mean arrival delay. Let’s examine how spread out the results are.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sf_25_means</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/mdsr/man/skim.html">skim</a></span><span class="op">(</span><span class="va">mean_arr_delay</span><span class="op">)</span></code></pre></div>
<p><strong>Variable type: numeric</strong></p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">var</th>
<th align="right">n</th>
<th align="right">na</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">mean_arr_delay</td>
<td align="right">500</td>
<td align="right">0</td>
<td align="right">2.39</td>
<td align="right">9.51</td>
<td align="right">-24.08</td>
<td align="right">-3.95</td>
<td align="right">1.1</td>
<td align="right">8.17</td>
<td align="right">55.44</td>
</tr></tbody>
</table></div>
<div id="standardized-vocabulary" class="section level4" number="4.2.4.1">
<h4>
<span class="header-section-number">4.2.4.1</span> Standardized vocabulary<a class="anchor" aria-label="anchor" href="#standardized-vocabulary"><i class="fas fa-link"></i></a>
</h4>
<p>To discuss reliability, it helps to have some standardized vocabulary.</p>
<p>The <strong>sample size</strong> is the number of cases in the sample, usually denoted with <span class="math inline">\(n\)</span>. In the above, the sample size is <span class="math inline">\(n = 25\)</span>.</p>
<p>The <strong>sampling distribution</strong> is the collection of the sample statistic from all of the trials. We carried out 500 trials here, but the exact number of trials is not important so long as it is large.</p>
<p>The <strong>shape</strong> of the sampling distribution is worth noting. Here it is a little skewed to the right. We can tell because in this case the mean is more than twice the median. (This text is correct even we have a very different result as in the book. In the book <span class="math inline">\(mean = 1,76\)</span>, and the <span class="math inline">\(median = 0.76\)</span>. Try it out again and draw another 500 sample without the set.seed() function or with a different value inside the function. You will get again different values, but again the distribution is little skewed to the right, e.g., the mean is bigger, mostly about the double of the median. In this sense the sample of 500 trials is already pretty stable.)</p>
<p>The <strong>standard error</strong> is the standard deviation of the sampling distribution. It describes the width of the sampling distribution. For the trials calculating the sample mean in samples with <span class="math inline">\(n = 25\)</span>, the standard error is 9.51 minutes. (You can see this value in the output of skim() above, as the standard deviation of the sample means that we generated.)</p>
<p>The 95% <strong>confidence interval</strong> is another way of summarizing the sampling distribution. From the calculation you can see it is about −16 to +21 minutes. The interval can be used to identify plausible values for the true mean arrival delay. It is calculated from the mean and standard error of the sampling distribution.</p>
</div>
</div>
<div id="d-confidence-intervals" class="section level3" number="4.2.5">
<h3>
<span class="header-section-number">4.2.5</span> D: Confidence intervals<a class="anchor" aria-label="anchor" href="#d-confidence-intervals"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sf_25_means</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>
    x_bar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">mean_arr_delay</span><span class="op">)</span>,
    se <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">mean_arr_delay</span><span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    ci_lower <span class="op">=</span> <span class="va">x_bar</span> <span class="op">-</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">se</span>, <span class="co"># approximately 95% of observations </span>
    ci_upper <span class="op">=</span> <span class="va">x_bar</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">se</span>  <span class="co"># are within two standard errors</span>
  <span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 × 4</span>
<span class="co">#&gt;   x_bar    se ci_lower ci_upper</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1  2.39  9.51    -16.6     21.4</span></code></pre></div>
<p>Again I have different values as the book. I have <span class="math inline">\(-16.7\)</span> to <span class="math inline">\(21.4\)</span> whereas the book results are <span class="math inline">\(-16.7\)</span> to <span class="math inline">\(20.2\)</span>. My results includes about 72 seconds more delays in the 95% confidence interval. (By the way: The correct calculation for a 95% CI would not be 2.0 but 1.96.)</p>
</div>
<div id="e-t-test" class="section level3" number="4.2.6">
<h3>
<span class="header-section-number">4.2.6</span> E: t-test<a class="anchor" aria-label="anchor" href="#e-t-test"><i class="fas fa-link"></i></a>
</h3>
<p>Alternatively, it can be calculated directly using a <a href="https://en.wikipedia.org/wiki/Student%27s_t-test">t-test</a>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sf_25_means</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">mean_arr_delay</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  One Sample t-test</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  .</span>
<span class="co">#&gt; t = 5.6247, df = 499, p-value = 3.099e-08</span>
<span class="co">#&gt; alternative hypothesis: true mean is not equal to 0</span>
<span class="co">#&gt; 95 percent confidence interval:</span>
<span class="co">#&gt;  1.556887 3.228393</span>
<span class="co">#&gt; sample estimates:</span>
<span class="co">#&gt; mean of x </span>
<span class="co">#&gt;   2.39264</span></code></pre></div>
<p>The result is significant because of a p-value of 0.00000003099.</p>
<p>The mean of 2.39 minutes is identical with the previous CI calculation. I have to confess that I have difficulties to interpret the other values of the t-test. But what about 1.56 and 3.23? Where does it come from?</p>
<div class="todobox">
<p>Check the interpretation of the results of a <code>t.test</code> in R with other books!</p>
</div>
</div>
<div id="sample-size-n-100" class="section level3" number="4.2.7">
<h3>
<span class="header-section-number">4.2.7</span> Sample size <span class="math inline">\(n = 100\)</span><a class="anchor" aria-label="anchor" href="#sample-size-n-100"><i class="fas fa-link"></i></a>
</h3>
<p>An important question that statistical methods allow you to address is what size of sample <span class="math inline">\(n\)</span> is needed to get a result with an acceptable reliability. Measuring the reliability is a straightforward matter of finding the standard error and/or confidence interval.</p>
<p>Notice that the sample statistic varies considerably. For samples of size <span class="math inline">\(n = 25\)</span> they range (in the book) from <span class="math inline">\(−17\)</span> to <span class="math inline">\(57\)</span> minutes. In my case it ranges from <span class="math inline">\(-24\)</span> to <span class="math inline">\(54\)</span> minutes. The spread in the book ist <span class="math inline">\(74\)</span> and in my case it is with <span class="math inline">\(78\)</span> even larger.</p>
<p>We used a sample size of <span class="math inline">\(n = 25\)</span> and found a standard error of 9.2 resp. 9.5 minutes. What would happen if we used an even larger sample, say <span class="math inline">\(n = 100\)</span>? The calculation is the same as before but with a different <span class="math inline">\(n\)</span>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">321</span><span class="op">)</span>

<span class="va">sf_100_means</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">500</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span>
    <span class="op">~</span> <span class="va">SF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean_arr_delay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">arr_delay</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span><span class="op">)</span>


<span class="va">sf_25_means</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">sf_100_means</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mean_arr_delay</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">30</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">n</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Sample mean"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-mdsr-09_files/figure-html/sample-100-1.png" width="672"></div>
<p>Comparing the two sampling distributions shows some patterns that are generally true for statistics such as the mean:</p>
<ul>
<li>Both sampling distributions are centered at the same value.</li>
<li>A larger sample size produces a standard error that is smaller. That is, a larger sample size is more reliable than a smaller sample size. You can see that the standard deviation for <span class="math inline">\(n = 100\)</span> is one-half that for <span class="math inline">\(n = 25\)</span>. As a rule, the standard error of a sampling distribution scales as 1/√n.</li>
<li>For large sample sizes, the shape of the sampling distribution tends to bell-shaped.</li>
</ul>
</div>
</div>
<div id="the-bootstrap" class="section level2" number="4.3">
<h2>
<span class="header-section-number">4.3</span> The bootstrap<a class="anchor" aria-label="anchor" href="#the-bootstrap"><i class="fas fa-link"></i></a>
</h2>
<div id="resampling" class="section level3" number="4.3.1">
<h3>
<span class="header-section-number">4.3.1</span> Resampling<a class="anchor" aria-label="anchor" href="#resampling"><i class="fas fa-link"></i></a>
</h3>
<p>The bootstrap is a statistical method that allows us to approximate the sampling distribution even without access to the population.</p>
<p>In the bootstrap we will draw many new samples from our original sample. This process is called <strong>resampling</strong>: drawing a new sample from an existing sample.</p>
<p>When sampling from a population, we would of course make sure not to duplicate any of the cases, just as we would never deal the same playing card twice in one hand. When resampling, however, we do allow such duplication (in fact, this is what allows us to estimate the variability of the sample). Therefore, we <strong>sample with replacement</strong>.</p>
<p>Bootstrapping does not create new cases: It isn’t a way to collect data.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">200</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">321</span><span class="op">)</span>

<span class="va">orig_sample</span> <span class="op">&lt;-</span> <span class="va">SF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="va">orig_sample</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean_arr_delay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">arr_delay</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 × 1</span>
<span class="co">#&gt;   mean_arr_delay</span>
<span class="co">#&gt;            &lt;dbl&gt;</span>
<span class="co">#&gt; 1          -6.42</span></code></pre></div>
</div>
<div id="sample-variation" class="section level3" number="4.3.2">
<h3>
<span class="header-section-number">4.3.2</span> Sample variation<a class="anchor" aria-label="anchor" href="#sample-variation"><i class="fas fa-link"></i></a>
</h3>
<p>By repeating this process many times, we’ll be able to see how much variation there is from sample to sample:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">321</span><span class="op">)</span>

<span class="va">sf_200_bs</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="va">num_trials</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span>
    <span class="op">~</span><span class="va">orig_sample</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean_arr_delay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">arr_delay</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span><span class="op">)</span>

<span class="va">sf_200_bs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/mdsr/man/skim.html">skim</a></span><span class="op">(</span><span class="va">mean_arr_delay</span><span class="op">)</span></code></pre></div>
<p><strong>Variable type: numeric</strong></p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">var</th>
<th align="right">n</th>
<th align="right">na</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">mean_arr_delay</td>
<td align="right">500</td>
<td align="right">0</td>
<td align="right">1.59</td>
<td align="right">3.42</td>
<td align="right">-5.36</td>
<td align="right">-0.88</td>
<td align="right">1.43</td>
<td align="right">3.73</td>
<td align="right">16.74</td>
</tr></tbody>
</table></div>
<p>We could estimate the standard deviation of the arrival delays to be about 3.1 (in the book), resp. 3.4 minutes (my example). Again I have used <code><a href="https://rdrr.io/r/base/Random.html">set.seed()</a></code>, so you can reproduce my results exactly.</p>
</div>
<div id="hypothetical-sample" class="section level3" number="4.3.3">
<h3>
<span class="header-section-number">4.3.3</span> Hypothetical sample<a class="anchor" aria-label="anchor" href="#hypothetical-sample"><i class="fas fa-link"></i></a>
</h3>
<p>Ordinarily, we wouldn’t be able to check this result. But because we have access to the population data in this example, we can. Let’s compare our bootstrap estimate to a set of (hypothetical) samples of size <span class="math inline">\(n = 200\)</span> from the original SF flights (the population).</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">321</span><span class="op">)</span>

<span class="va">sf_200_pop</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="va">num_trials</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span>
    <span class="op">~</span><span class="va">SF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean_arr_delay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">arr_delay</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span><span class="op">)</span>

<span class="va">sf_200_pop</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/mdsr/man/skim.html">skim</a></span><span class="op">(</span><span class="va">mean_arr_delay</span><span class="op">)</span></code></pre></div>
<p><strong>Variable type: numeric</strong></p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">var</th>
<th align="right">n</th>
<th align="right">na</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">mean_arr_delay</td>
<td align="right">500</td>
<td align="right">0</td>
<td align="right">2.37</td>
<td align="right">3.37</td>
<td align="right">-7.96</td>
<td align="right">0.06</td>
<td align="right">2.16</td>
<td align="right">4.36</td>
<td align="right">13.54</td>
</tr></tbody>
</table></div>
<p>Notice that the population was not used in the bootstrap (<code>sf_200_bs</code>), just the original sample. What’s remarkable here is that the standard error calculated using the bootstrap (3.1 resp. 3.4 minutes) is a reasonable approximation to the standard error of the sampling distribution calculated by taking repeated samples from the population (3.3 resp. 3.4 minutes). In my case it is not only a reasonable approximation but both sample and hypothetical sample have — after rounding — the same value (3.4 minutes)!</p>
<p>The distribution of values in the bootstrap trials is called the <strong>bootstrap distribution</strong>. It’s not exactly the same as the sampling distribution, but for moderate to large sample sizes and sufficient number of bootstraps it has been proven to approximate those aspects of the sampling distribution that we care most about, such as the standard error and quantiles (B. Efron and Tibshirani 1993).</p>
</div>
<div id="travel-policy" class="section level3" number="4.3.4">
<h3>
<span class="header-section-number">4.3.4</span> Travel Policy<a class="anchor" aria-label="anchor" href="#travel-policy"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">orig_sample</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>q98 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">arr_delay</span>, p <span class="op">=</span> <span class="fl">0.98</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 × 1</span>
<span class="co">#&gt;     q98</span>
<span class="co">#&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1  109.</span></code></pre></div>
<p>The sample itself suggests a policy of scheduling a flight to arrive 141 minutes early. Compare the big difference to my sample where just 110 minutes (= more than a half hour less!) would be enough.</p>
<p>Let us check the reliability of that estimate using bootstrapping.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">orig_sample</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">321</span><span class="op">)</span>
<span class="va">sf_200_bs</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="va">num_trials</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span>
    <span class="op">~</span><span class="va">orig_sample</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>q98 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">arr_delay</span>, p <span class="op">=</span> <span class="fl">0.98</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>

<span class="va">sf_200_bs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/mdsr/man/skim.html">skim</a></span><span class="op">(</span><span class="va">q98</span><span class="op">)</span></code></pre></div>
<p><strong>Variable type: numeric</strong></p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">var</th>
<th align="right">n</th>
<th align="right">na</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">q98</td>
<td align="right">500</td>
<td align="right">0</td>
<td align="right">114.27</td>
<td align="right">39.12</td>
<td align="right">70.1</td>
<td align="right">85.39</td>
<td align="right">109.3</td>
<td align="right">124.84</td>
<td align="right">445</td>
</tr></tbody>
</table></div>
<p>The bootstrapped standard error is about 29 (resp. 39!) minutes. The corresponding 95% confidence interval is <span class="math inline">\(140 ± 58\)</span> resp. <span class="math inline">\(114 ± 78\)</span> minutes. A policy based on this would be practically a shot in the dark: unlikely to hit the target.</p>
<p>One way to fix things might be to collect more data, hoping to get a more reliable estimate of the <span class="math inline">\(98^{th}\)</span> percentile. Imagine that we could do the work to generate a sample with <span class="math inline">\(n = 10,000\)</span> cases.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1001</span><span class="op">)</span>
<span class="va">n_large</span> <span class="op">&lt;-</span> <span class="fl">10000</span>
<span class="va">sf_10000_bs</span> <span class="op">&lt;-</span> <span class="va">SF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_large</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="va">sf_200_bs</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="va">num_trials</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span><span class="op">~</span><span class="va">sf_10000_bs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_large</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>q98 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">arr_delay</span>, p <span class="op">=</span> <span class="fl">0.98</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>

<span class="va">sf_200_bs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/mdsr/man/skim.html">skim</a></span><span class="op">(</span><span class="va">q98</span><span class="op">)</span></code></pre></div>
<p><strong>Variable type: numeric</strong></p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">var</th>
<th align="right">n</th>
<th align="right">na</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">q98</td>
<td align="right">500</td>
<td align="right">0</td>
<td align="right">153.88</td>
<td align="right">4.14</td>
<td align="right">139.02</td>
<td align="right">151.02</td>
<td align="right">153.02</td>
<td align="right">156.02</td>
<td align="right">169</td>
</tr></tbody>
</table></div>
<p>This time the book used <code><a href="https://rdrr.io/r/base/Random.html">set.seed()</a></code>. So we get the same results: The standard deviation is much narrower, <span class="math inline">\(154 ± 8\)</span> minutes. Having more data makes it easier to better refine estimates, particularly in the tails.</p>
</div>
</div>
<div id="outliers" class="section level2" number="4.4">
<h2>
<span class="header-section-number">4.4</span> Outliers<a class="anchor" aria-label="anchor" href="#outliers"><i class="fas fa-link"></i></a>
</h2>
<p>Outliers can often tell us interesting things. How they should be handled depends on their cause:</p>
<div class="infobox">
<ul>
<li>Outliers due to data irregularities or errors should be fixed.</li>
<li>Other outliers may yield important insights.</li>
<li>Outliers should never be dropped unless there is a clear rationale.</li>
<li>If outliers are dropped this should be clearly reported.</li>
</ul>
</div>
<p>Suppose we consider any flight delayed by 7 hours (420 minutes) or more as an extreme event (see Section 15.5). While an arbitrary choice, 420 minutes may be valuable as a marker for seriously delayed flights.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">arr_delay</span> <span class="op">&gt;=</span> <span class="fl">420</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">month</span>, <span class="va">day</span>, <span class="va">dep_delay</span>, <span class="va">arr_delay</span>, <span class="va">carrier</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 7 × 5</span>
<span class="co">#&gt;   month   day dep_delay arr_delay carrier</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;  </span>
<span class="co">#&gt; 1    12     7       374       422 UA     </span>
<span class="co">#&gt; 2     7     6       589       561 DL     </span>
<span class="co">#&gt; 3     7     7       629       676 VX     </span>
<span class="co">#&gt; 4     7     7       653       632 VX     </span>
<span class="co">#&gt; 5     7    10       453       445 B6     </span>
<span class="co">#&gt; 6     7    10       432       433 VX     </span>
<span class="co">#&gt; 7     9    20      1014      1007 AA</span></code></pre></div>
<p>Most of the very long delays (five of seven) were in July, and Virgin America (<code>VX</code>) is the most frequent offender. Immediately, this suggests one possible route for improving the outcome of the business travel policy we have been asked to develop. We could tell people to arrive extra early in July and to avoid <code>VX</code>.</p>
<div class="greybox">
<p>In addition to this remark there is also another pattern: There is a narrow connection between <code>arr_delay</code> and <code>dep_delay</code>. All outliers have already a departure delay of the same magnitude of their arrival delay. The main cause of their delays is not the flight itself. Four of these outliers have even (slightly) reduced their delay after their flights.</p>
<p>For someone who wants to research the main causes of flight delays this is a hint to look into departure delays (and not into arrival delays). Question might be:</p>
<ul>
<li>Is the relation between departure and arrival delay only observable with outliers respectively with huge departure delays or is it a general pattern?</li>
<li>What exactly does it mean to have a departure delay? Is this a consequence of a late arrival? Maybe even a series of delayed arrivals?</li>
</ul>
<p>The first question could be answered with the dataset, the second not.</p>
</div>
<div class="todobox">
<p>How to answer the first question? Is there a general relationship between departure and arrival delays? (The second question I cannot answer with my available data.)</p>
</div>
<div class="graybox">
<p>These questions are examples of an EDA connecting with outliers. I believe that a group of outliers always pose some interesting questions. As not inspiring further research, some of them may be coded wrongly. But if all of them are wrong then there is the interesting questions: What is the reason for this massive wrongly coded data?</p>
</div>
<p>The large majority of flights arrive without any delay or a delay of less than 60 minutes. Might we be able to identify patterns that can presage when the longer delays are likely to occur? The outliers suggested that <code>month</code> or <code>carrier</code> may be linked to long delays. Let’s see how that plays out with the large majority of data.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>long_delay <span class="op">=</span> <span class="va">arr_delay</span> <span class="op">&gt;</span> <span class="fl">60</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">month</span>, <span class="va">long_delay</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">month</span>, values_from <span class="op">=</span> <span class="va">n</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt;   long_delay  X1  X2  X3  X4   X5  X6  X7   X8   X9  X10  X11  X12</span>
<span class="co">#&gt; 1      FALSE 856 741 812 993 1128 980 966 1159 1124 1177 1107 1093</span>
<span class="co">#&gt; 2       TRUE  29  21  61 112   65 209 226   96   65   36   51   66</span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>long_delay <span class="op">=</span> <span class="va">arr_delay</span> <span class="op">&gt;</span> <span class="fl">60</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">carrier</span>, <span class="va">long_delay</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">carrier</span>, values_from <span class="op">=</span> <span class="va">n</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt;   long_delay   AA  B6   DL   UA   VX</span>
<span class="co">#&gt; 1      FALSE 1250 934 1757 6236 1959</span>
<span class="co">#&gt; 2       TRUE  148  86   91  492  220</span></code></pre></div>
<p>Two results:</p>
<ol style="list-style-type: decimal">
<li>We see that June and July (months 6 and 7) are problem months.</li>
<li>Delta Airlines (<code>DL</code>) has reasonable performance. (See <a href="https://mdsr-book.github.io/mdsr2e/ch-sql.html#sec:ft8-flights">Section 15.5</a> for a fuller discussion of which airlines seem to have fewer delays in general.)</li>
</ol>
</div>
<div id="statistical-models" class="section level2" number="4.5">
<h2>
<span class="header-section-number">4.5</span> Statistical models<a class="anchor" aria-label="anchor" href="#statistical-models"><i class="fas fa-link"></i></a>
</h2>
<p>Statistical modeling provides a way to relate variables to one another. Doing so helps us better understand the system we are studying.</p>
<p>For illustration we will investige the following question: What impact, if any, does scheduled time of departure have on expected flight delay? Many people think that earlier flights are less likely to be delayed, since flight delays tend to cascade over the course of the day. Is this theory supported by the data?</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SF</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">hour</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">hour</span>,
              values_from <span class="op">=</span> <span class="va">n</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt;   X5  X6   X7  X8  X9  X10 X11 X12 X13 X14 X15 X16  X17  X18 X19 X20 X21</span>
<span class="co">#&gt; 1 55 663 1696 987 429 1744 413 504 476 528 946 897 1491 1091 731 465  57</span></code></pre></div>
<div class="greybox">
<p>In contrast to the book my code snippet has two changes:</p>
<ul>
<li>I added a <code>names_prefix</code> for the purpose of my personal learning. I thought that without this option a numeric vector prefixes an <code>X</code> in front of the value. <em>But this is not true!</em> It is the additional <code><a href="https://tibble.tidyverse.org/reference/deprecated.html">data_frame()</a></code> function, that adds the X as in the box results. Actually I do not know what the reason for this function otherwise would be. As I prefer to work with tibbles (and not with data frames) I did not use the <code><a href="https://tibble.tidyverse.org/reference/deprecated.html">data_frame()</a></code> function. If you want all values prefixed with <code>X</code> I would suggest to use the <code>names_prefix</code> option..</li>
<li>As I already mentioned: I did not use the <code><a href="https://tibble.tidyverse.org/reference/deprecated.html">data_frame()</a></code> function.</li>
</ul>
<p>Even the <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> function is not necessary in my opinion. It purpose is only to shorten the presentation for the book by displaying all values in one line.</p>
</div>
<p>We see that many flights are scheduled in the early to mid-morning and from the late afternoon to early evening. None are scheduled before 5 am or after 10 pm.</p>
<div class="todobox">
<p>I am not sure if listing values is the appropriate method. Maybe a histogram would be better?</p>
</div>
<div class="todobox">
<p>Visualize the above grouping by hour.</p>
</div>
<p>Let’s examine how the arrival delay depends on the hour. We’ll do this in two ways: first using standard box-and-whisker plots to show the distribution of arrival delays; second with a kind of statistical model called a linear model that lets us track the mean arrival delay over the course of the day.</p>
<div id="box-and-whisker-plot" class="section level3" number="4.5.1">
<h3>
<span class="header-section-number">4.5.1</span> Box and whisker plot<a class="anchor" aria-label="anchor" href="#box-and-whisker-plot"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hour</span>, y <span class="op">=</span> <span class="va">arr_delay</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>outlier.alpha <span class="op">=</span> <span class="fl">0.1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">hour</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># first method</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span> <span class="op">+</span>                           <span class="co"># second method</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Scheduled hour of departure"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Arrival delay (minutes)"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">30</span>, <span class="fl">120</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; `geom_smooth()` using formula 'y ~ x'</span></code></pre></div>
<div class="inline-figure"><img src="03-mdsr-09_files/figure-html/delay-boxplot-lm-1.png" width="672"></div>
<p>The figure displays the arrival delay versus schedule departure hour. The average arrival delay increases over the course of the day. The trend line itself is created via a regression model (see Appendix E).</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">arr_delay</span> <span class="op">~</span> <span class="va">hour</span>, data <span class="op">=</span> <span class="va">SF</span><span class="op">)</span>
<span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 2 × 5</span>
<span class="co">#&gt;   term        estimate std.error statistic   p.value</span>
<span class="co">#&gt;   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1 (Intercept)   -22.9     1.23       -18.6 2.88e- 76</span>
<span class="co">#&gt; 2 hour            2.01    0.0915      22.0 1.78e-105</span></code></pre></div>
</div>
<div id="model-interpretation" class="section level3" number="4.5.2">
<h3>
<span class="header-section-number">4.5.2</span> Model interpretation<a class="anchor" aria-label="anchor" href="#model-interpretation"><i class="fas fa-link"></i></a>
</h3>
<div id="column-estimate" class="section level4" number="4.5.2.1">
<h4>
<span class="header-section-number">4.5.2.1</span> Column “estimate”<a class="anchor" aria-label="anchor" href="#column-estimate"><i class="fas fa-link"></i></a>
</h4>
<div class="greybox">
<p>I believe that the intercept has no meaning here. (Is this correct?)</p>
</div>
<p>The number under the “estimate” for hour indicates that the arrival delay is predicted to be about 2 minutes higher per hour. Over the 15 hours of flights, this leads to a 30-minute increase in arrival delay comparing flights at the end of the day to flights at the beginning of the day.</p>
</div>
<div id="standard-error" class="section level4" number="4.5.2.2">
<h4>
<span class="header-section-number">4.5.2.2</span> Standard error<a class="anchor" aria-label="anchor" href="#standard-error"><i class="fas fa-link"></i></a>
</h4>
<p>The <code>tidy()</code> function from the <strong>{broom}</strong> package also calculates the standard error: 0.09 minutes per hour.</p>
<p>Stated as a 95% confidence interval, this model indicates that we are 95% confident that the true arrival delay increases by <span class="math inline">\(2.0 ± 0.18\)</span> minutes per hour.</p>
</div>
<div id="p-value" class="section level4" number="4.5.2.3">
<h4>
<span class="header-section-number">4.5.2.3</span> p-value<a class="anchor" aria-label="anchor" href="#p-value"><i class="fas fa-link"></i></a>
</h4>
<p>The rightmost column gives the p-value, a way of translating the estimate and standard error onto a scale from zero to one. By convention, p-values below 0.05 provide a kind of certificate testifying that random, accidental patterns would be unlikely to generate an estimate as large as that observed. The tiny p-value given in the report (2e-16 is 0.0000000000000002) is another way that “random, accidental patterns would be unlikely to generate an estimate as large as that observed.”</p>
<div class="greenbox">
<p>The general formel for the interpretation for the p-value is:</p>
<p>The p-value is another way of saying that if there was no association, we would be very unlikely to see a result this extreme or more extreme.</p>
</div>
<p>Despite an almost universal practice of presenting p-values, they are mostly misunderstood even by scientists and other professionals. The p-value conveys much less information than usually supposed: The “certificate” might not be worth the paper it’s printed on (see Section 9.7).</p>
</div>
</div>
<div id="multiple-regression-linear-model" class="section level3" number="4.5.3">
<h3>
<span class="header-section-number">4.5.3</span> Multiple regression linear model<a class="anchor" aria-label="anchor" href="#multiple-regression-linear-model"><i class="fas fa-link"></i></a>
</h3>
<p>Can we do better? What additional factors might help to explain flight delays? Let’s look at</p>
<ul>
<li>departure airport (<code>origin</code>)</li>
<li>airline (<code>carrier</code>)</li>
<li>month of the year (6 and 7 as <code>season</code>)</li>
<li>day of the week (<code>dow</code>).</li>
</ul>
<p>Some data wrangling with the help of the <strong>{lubricate}</strong> package will let us extract the day of the week (dow) from the year, month, and day of month.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'lubridate'</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     date, intersect, setdiff, union</span>
<span class="va">SF</span> <span class="op">&lt;-</span> <span class="va">SF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">time_hour</span><span class="op">)</span>, 
    dow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html">wday</a></span><span class="op">(</span><span class="va">day</span>, label <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,
    season <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">month</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fl">6</span><span class="op">:</span><span class="fl">7</span>, <span class="st">"summer"</span>, <span class="st">"other month"</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<p>Now we can build a model that includes variables we want to use to explain arrival delay.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">arr_delay</span> <span class="op">~</span> <span class="va">hour</span> <span class="op">+</span> <span class="va">origin</span> <span class="op">+</span> <span class="va">carrier</span> <span class="op">+</span> <span class="va">season</span> <span class="op">+</span> <span class="va">dow</span>, data <span class="op">=</span> <span class="va">SF</span><span class="op">)</span>
<span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">mod2</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 14 × 5</span>
<span class="co">#&gt;    term         estimate std.error statistic   p.value</span>
<span class="co">#&gt;    &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1 (Intercept)   -24.6      2.17     -11.3   1.27e- 29</span>
<span class="co">#&gt;  2 hour            2.08     0.0898    23.2   1.44e-116</span>
<span class="co">#&gt;  3 originJFK       4.12     1.00       4.10  4.17e-  5</span>
<span class="co">#&gt;  4 carrierB6     -10.3      1.88      -5.49  4.07e-  8</span>
<span class="co">#&gt;  5 carrierDL     -18.4      1.62     -11.4   5.88e- 30</span>
<span class="co">#&gt;  6 carrierUA      -4.76     1.48      -3.21  1.31e-  3</span>
<span class="co">#&gt;  7 carrierVX      -5.06     1.60      -3.17  1.54e-  3</span>
<span class="co">#&gt;  8 seasonsummer   25.3      1.03      24.5   5.20e-130</span>
<span class="co">#&gt;  9 dowMon          1.74     1.45       1.20  2.28e-  1</span>
<span class="co">#&gt; 10 dowSat         -5.60     1.55      -3.62  2.98e-  4</span>
<span class="co">#&gt; 11 dowSun          5.12     1.48       3.46  5.32e-  4</span>
<span class="co">#&gt; 12 dowThu          3.16     1.45       2.18  2.90e-  2</span>
<span class="co">#&gt; 13 dowTue         -1.65     1.45      -1.14  2.53e-  1</span>
<span class="co">#&gt; 14 dowWed         -0.884    1.45      -0.610 5.42e-  1</span></code></pre></div>
<p>The numbers in the “estimate” column tell us that we should add 4.1 minutes to the average delay if departing from JFK (instead of EWR, also known as Newark, which is the reference group). Delta has a better average delay than the other carriers. Delays are on average longer in June and July (by 25 minutes), and on Sundays (by 5 minutes).</p>
<div class="infobox">
<p>For every variable there is a reference value. It is the element that comes first alphabetically. For instance, let us see all the levels of the factor <code>carrier</code>.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">SF</span><span class="op">$</span><span class="va">carrier</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "AA" "B6" "DL" "UA" "VX"</span></code></pre></div>
<p>In this case American Airlines (<code>AA</code>) is the reference group of flights. (See the dataframe <code>airlines</code> to get the full name from the carrier code)</p>
</div>
<p>The model also indicates that Sundays are associated with roughly 5 minutes of additional delays; Saturdays are 6 minutes less delayed on average. (Each of the days of the week is being compared to Friday, chosen as the reference group because it comes first alphabetically.)</p>
<p>The standard errors tell us the precision of these estimates; the p-values describe whether the individual patterns are consistent with what might be expected to occur by accident even if there were no systemic association between the variables.</p>
<p>In this example, we’ve used <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> to construct what are called linear models. Linear models describe how the mean of the response variable varies with the explanatory variables. They are the most widely used statistical modeling technique, but there are others. In particular, since our original motivation was to set a policy about business travel, we might want a modeling technique that lets us look at another question: What is the probability that a flight will be, say, greater than 100 minutes late? Without going into detail, we’ll mention that a technique called logistic regression is appropriate for such dichotomous outcomes (see Chapter 11 and Section E.5 for more examples).</p>
</div>
</div>
<div id="confounding-factors" class="section level2" number="4.6">
<h2>
<span class="header-section-number">4.6</span> Confounding factors<a class="anchor" aria-label="anchor" href="#confounding-factors"><i class="fas fa-link"></i></a>
</h2>
<p>Let’s consider an example of confounding using observational data on average teacher salaries (in 2010) and average total SAT scores for each of the 50 United States. The SAT (Scholastic Aptitude Test) is a high-stakes exam used for entry into college. Are higher teacher salaries associated with better outcomes on the test at the state level? If so, should we adjust salaries to improve test performance? The following figure displays a scatterplot of these data. We also fit a linear regression model.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SAT_2010</span> <span class="op">&lt;-</span> <span class="va">SAT_2010</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Salary <span class="op">=</span> <span class="va">salary</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span>
<span class="va">SAT_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">SAT_2010</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Salary</span>, y <span class="op">=</span> <span class="va">total</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Average total score on the SAT"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Average teacher salary (thousands of USD)"</span><span class="op">)</span>
<span class="va">SAT_plot</span>
<span class="co">#&gt; `geom_smooth()` using formula 'y ~ x'</span></code></pre></div>
<div class="inline-figure"><img src="03-mdsr-09_files/figure-html/sat-scatterplot-1.png" width="672"></div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SAT_mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">total</span> <span class="op">~</span> <span class="va">Salary</span>, data <span class="op">=</span> <span class="va">SAT_2010</span><span class="op">)</span>
<span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">SAT_mod1</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 2 × 5</span>
<span class="co">#&gt;   term        estimate std.error statistic  p.value</span>
<span class="co">#&gt;   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1 (Intercept)  1871.      113.       16.5  1.86e-21</span>
<span class="co">#&gt; 2 Salary         -5.02      2.05     -2.45 1.79e- 2</span></code></pre></div>
<div class="infobox">
<p>The strange result is that there is a <em>negative association</em> with teacher salaries. This means that states would have to lower the salary of teacher to get better SAT results!</p>
</div>
<p>Lurking in the background, however, is another important factor. The percentage of students who take the SAT in each state varies dramatically (from 3% to 93% in 2010). We can create a variable called <code>SAT_grp</code> that divides the states into two groups.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SAT_2010</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/mdsr/man/skim.html">skim</a></span><span class="op">(</span><span class="va">sat_pct</span><span class="op">)</span></code></pre></div>
<p><strong>Variable type: numeric</strong></p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">var</th>
<th align="right">n</th>
<th align="right">na</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">sat_pct</td>
<td align="right">50</td>
<td align="right">0</td>
<td align="right">38.52</td>
<td align="right">31.99</td>
<td align="right">3</td>
<td align="right">6</td>
<td align="right">27</td>
<td align="right">68</td>
<td align="right">93</td>
</tr></tbody>
</table></div>
<p>We will take the median to create two equally sized groups:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SAT_2010</span> <span class="op">&lt;-</span> <span class="va">SAT_2010</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>SAT_grp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">sat_pct</span> <span class="op">&lt;=</span> <span class="fl">27</span>, <span class="st">"Low"</span>, <span class="st">"High"</span><span class="op">)</span><span class="op">)</span>

<span class="va">SAT_2010</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">SAT_grp</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 2 × 2</span>
<span class="co">#&gt; # Groups:   SAT_grp [2]</span>
<span class="co">#&gt;   SAT_grp     n</span>
<span class="co">#&gt;   &lt;chr&gt;   &lt;int&gt;</span>
<span class="co">#&gt; 1 High       25</span>
<span class="co">#&gt; 2 Low        25</span></code></pre></div>
<p>Now we can display a scatterplot of these data stratified by the grouping of percentage taking the SAT.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SAT_plot</span> <span class="op"><a href="https://ggplot2.tidyverse.org/reference/gg-add.html">%+%</a></span> <span class="va">SAT_2010</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">SAT_grp</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span><span class="st">"% taking\nthe SAT"</span>, palette <span class="op">=</span> <span class="st">"Set2"</span><span class="op">)</span>
<span class="co">#&gt; `geom_smooth()` using formula 'y ~ x'</span></code></pre></div>
<div class="inline-figure"><img src="03-mdsr-09_files/figure-html/stratified-sat-1.png" width="672"></div>
<div class="greybox">
<ol style="list-style-type: decimal">
<li>What does <code>%+%</code> mean? It is a kind concatenation of character vecotrs. It comes from the <strong>{crayon}</strong> package which provides colored terminal output.</li>
<li>What is above concatenated? The preferences of the previous scatterplot are combined with the new stratified <code>SAT-data</code>. This is an interesting application because <code>SAT_plot</code> is type <code>gg</code> and <code>SAT_2010</code> is type <code>data.frame</code>.</li>
</ol>
</div>
</div>
<div id="perils-of-p-value" class="section level2" number="4.7">
<h2>
<span class="header-section-number">4.7</span> Perils of p-value<a class="anchor" aria-label="anchor" href="#perils-of-p-value"><i class="fas fa-link"></i></a>
</h2>
<p>Several take home messages:</p>
<div id="defintion-of-p-value" class="section level3" number="4.7.1">
<h3>
<span class="header-section-number">4.7.1</span> Defintion of p-value<a class="anchor" aria-label="anchor" href="#defintion-of-p-value"><i class="fas fa-link"></i></a>
</h3>
<div class="infobox">
<p>A p-value is defined as the probability of seeing a sample statistic as extreme (or more extreme) than the one that was observed if it were really the case that patterns in the data are a result of random chance. This hypothesis, that only randomness is in play, is called the null hypothesis.</p>
</div>
</div>
<div id="how-to-report-p-values" class="section level3" number="4.7.2">
<h3>
<span class="header-section-number">4.7.2</span> How to report p-values<a class="anchor" aria-label="anchor" href="#how-to-report-p-values"><i class="fas fa-link"></i></a>
</h3>
<div class="infobox">
<p>Always report the actual p-value (or a statement that it is less than some small value such as p &lt; 0.0001) rather than just the decision (reject null vs. fail to reject the null). In addition, confidence intervals are often more interpretable and should be reported as well.</p>
</div>
</div>
<div id="some-asa-principles" class="section level3" number="4.7.3">
<h3>
<span class="header-section-number">4.7.3</span> Some ASA principles<a class="anchor" aria-label="anchor" href="#some-asa-principles"><i class="fas fa-link"></i></a>
</h3>
<div class="infobox">
<ul>
<li>p-values do not measure the probability that the studied hypothesis is true, or the probability that the data were produced by random chance alone.</li>
<li>Scientific conclusions and business or policy decisions should not be based only on whether a p-value passes a specific threshold.</li>
<li>A p-value, or statistical significance, does not measure the size of an effect or the importance of a result.</li>
<li>By itself, a p-value does not provide a good measure of evidence regarding a model or hypothesis.</li>
</ul>
</div>
</div>
<div id="multiple-comparisons" class="section level3" number="4.7.4">
<h3>
<span class="header-section-number">4.7.4</span> Multiple comparisons<a class="anchor" aria-label="anchor" href="#multiple-comparisons"><i class="fas fa-link"></i></a>
</h3>
<p>Imagine that a clinical trial has five outcomes that are defined as being of primary interest. If the usual procedure in which a test is declared statistically significant if its p-value is less than 0.05 is used, the null hypotheses are true, and the tests are independent, we would expect that we would reject one or more of the null hypotheses more than 22% of the time (considerably more than 5% of the time we want).</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fl">1</span> <span class="op">-</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">^</span><span class="fl">5</span>
<span class="co">#&gt; [1] 0.2262191</span></code></pre></div>
<p>A simple, albeit conservative approach to counteract the problem of multiple comparisons is the use of a <a href="https://en.wikipedia.org/wiki/Bonferroni_correction">Bonferroni correction</a>. Consider dividing our <span class="math inline">\(α\)</span>-level by the number of tests, and only rejecting the null hypothesis when the p-value is less than this adjusted value. In our example, the new threshold would be <span class="math inline">\(0.01\)</span> (and the overall experiment-wise error rate is preserved at <span class="math inline">\(0.05\)</span>).</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fl">1</span> <span class="op">-</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span><span class="op">^</span><span class="fl">5</span>
<span class="co">#&gt; [1] 0.04900995</span></code></pre></div>
<div class="infobox">
<p>For analyses that involve many hypothesis tests it is appropriate to include a note of possible limitations that some of the results may be spurious due to <a href="https://en.wikipedia.org/wiki/Multiple_comparisons_problem">multiple comparisons</a>.</p>
</div>
</div>
<div id="garden-of-forking-paths" class="section level3" number="4.7.5">
<h3>
<span class="header-section-number">4.7.5</span> Garden of forking paths<a class="anchor" aria-label="anchor" href="#garden-of-forking-paths"><i class="fas fa-link"></i></a>
</h3>
<p><a href="https://en.wikipedia.org/wiki/The_Garden_of_Forking_Paths">El jardín de senderos que se bifurcan</a> (Garden of forking path) is a book by Jorge Luis Borges.</p>
<p>A related problem has been called the garden of forking paths by Andrew Gelman of Columbia University. Most analyses involve many decisions about how to code data, determine important factors, and formulate and then revise models before the final analyses are set. This process involves looking at the data to construct a parsimonious representation. For example, a continuous predictor might be cut into some arbitrary groupings to assess the relationship between that predictor and the outcome. Or certain variables might be included or excluded from a regression model in an exploratory process.</p>
<p>This process tends to lead towards hypothesis tests that are biased against a null result, since decisions that yield more of a signal (or smaller p-value) might be chosen rather than other options. In clinical trials, the garden of forking paths problem may be less common, since analytic plans need to be prespecified and published. For most data science problems, however, this is a vexing issue that leads to questions about reproducible results.</p>
<div class="infobox">
<p>To counteract the garden of forking paths preregistration may help: Analytic plans need to be prespecified and published. So you can demonstrate and people can examine what were you plans before you have started with the study and data wrangling.</p>
</div>
</div>
</div>
<div id="further-resources" class="section level2" number="4.8">
<h2>
<span class="header-section-number">4.8</span> Further resources<a class="anchor" aria-label="anchor" href="#further-resources"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>Diez, D. M., Barr, C. D., &amp; Cetinkaya-Rundel, M. (2012). OpenIntro statistics. CreateSpace. Abgerufen von <a href="http://www.academia.edu/download/34286417/statistics_open_book.pdf" class="uri">http://www.academia.edu/download/34286417/statistics_open_book.pdf</a>
</li>
</ul>
</div>
</div>
  <div class="chapter-nav">
<div class="empty"></div>
<div class="empty"></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Learning Data Science with R</strong>" was written by Peter Baumgartner. It was last built on 2021-12-29.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
